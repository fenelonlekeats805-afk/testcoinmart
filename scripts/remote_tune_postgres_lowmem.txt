bash -lc 'set -euo pipefail; CONF="/etc/postgresql/14/main/postgresql.conf"; sed -i "s/^max_connections = .*/max_connections = 30/" "$CONF"; sed -i "s/^shared_buffers = .*/shared_buffers = 32MB/" "$CONF"; if grep -q "^work_mem = " "$CONF"; then sed -i "s/^work_mem = .*/work_mem = 1MB/" "$CONF"; elif grep -q "^#work_mem = " "$CONF"; then sed -i "s/^#work_mem = .*/work_mem = 1MB/" "$CONF"; else echo "work_mem = 1MB" >> "$CONF"; fi; systemctl restart postgresql@14-main; pg_lsclusters'
